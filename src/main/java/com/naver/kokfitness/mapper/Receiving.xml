<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.naver.kokfitness.service.ReceivingDAO">
	<resultMap type="com.naver.kokfitness.entities.Receiving" id="receivingMap">
		<id property="seq" column="seq"/>
		<id property="bp_code" column="bp_code"/>
		<id property="bp_name" column="bp_name"/>
		<id property="consume_code" column="consume_code"/>
		<id property="consume_name" column="consume_name"/>
		<id property="yyyy" column="yyyy"/>
		<id property="mm" column="mm"/>
		<id property="dd" column="dd"/>
		<id property="no" column="no"/>
		<id property="hang" column="hang"/>
		<id property="price" column="price"/>
		<id property="qty" column="qty"/>
		<id property="total" column="total"/>
		<id property="columnname" column="columnname"/>
		<id property="memo" column="memo"/>
	</resultMap>
	<select id="selectSequenceNo" parameterType="hashMap" resultType="Integer">
		select ifnull(MAX(no)+1,1) from receiving alias_seq where 
		yyyy=#{yyyy} and mm=#{mm} and dd=#{dd}
	</select>
	<select id="receivingSelectListAll" parameterType="hashMap" resultMap="receivingMap">
		select seq,A.bp_code,B.name bp_name,yyyy,mm,dd,no,hang,consume_code,C.name consume_name,A.price,qty,memo,sum(A.price*qty) as total 
		from receiving A, business_partner B, consumable C 
		where A.bp_code=B.code and A.consume_code=C.code and 
		yyyy=#{yyyy} and mm=#{mm} and dd=#{dd}
		group by no,hang with rollup;
	</select>
	<insert id="receivingInsert" parameterType="hashMap">
		insert into receiving(seq,bp_code,yyyy,mm,dd,no,hang,consume_code,price,qty,memo
		)values(
		((select ifnull(MAX(seq)+1,1) from receiving alias_seq)),#{bp_code,jdbcType=VARCHAR},#{yyyy,jdbcType=VARCHAR},#{mm,jdbcType=VARCHAR},#{dd,jdbcType=VARCHAR},
		#{no,jdbcType=INTEGER},#{hang,jdbcType=INTEGER},#{consume_code,jdbcType=VARCHAR},
		#{price,jdbcType=INTEGER},#{qty,jdbcType=INTEGER},#{memo,jdbcType=VARCHAR})
	</insert>
	
</mapper>